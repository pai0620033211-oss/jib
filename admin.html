<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - JIB Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }</style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-gray-900 text-white flex flex-col">
        <div class="p-6 text-2xl font-bold italic border-b border-gray-800">
            <i class="fas fa-user-shield"></i> Admin<span class="text-yellow-400">Panel</span>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="showSection('dashboard')" class="w-full text-left p-3 rounded hover:bg-gray-800 text-gray-300 hover:text-white transition menu-item bg-gray-800 text-white" id="btn-dashboard">
                <i class="fas fa-chart-line w-6"></i> ภาพรวม
            </button>
            <button onclick="showSection('orders')" class="w-full text-left p-3 rounded hover:bg-gray-800 text-gray-300 hover:text-white transition menu-item" id="btn-orders">
                <i class="fas fa-shopping-bag w-6"></i> รายการสั่งซื้อ
            </button>
            <button onclick="showSection('reviews')" class="w-full text-left p-3 rounded hover:bg-gray-800 text-gray-300 hover:text-white transition menu-item" id="btn-reviews">
                <i class="fas fa-comments w-6"></i> ตอบกลับรีวิว
            </button>
        </nav>
        <div class="p-4 border-t border-gray-800">
            <a href="index.html" class="block w-full text-center py-2 rounded bg-red-600 hover:bg-red-700 transition">ออกจากระบบ</a>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-8">
        
        <div id="section-dashboard" class="space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ภาพรวมร้านค้า</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-xl shadow border-l-4 border-blue-500">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">ยอดขายรวม</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-total-sales">฿0</h3>
                        </div>
                        <i class="fas fa-coins text-3xl text-blue-200"></i>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow border-l-4 border-green-500">
                     <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">จำนวนออเดอร์</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-order-count">0</h3>
                        </div>
                        <i class="fas fa-shopping-cart text-3xl text-green-200"></i>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow border-l-4 border-purple-500">
                     <div class="flex justify-between items-center">
                        <div>
                            <p class="text-gray-500 text-sm">สมาชิกรวม</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="stat-user-count">0</h3>
                        </div>
                        <i class="fas fa-users text-3xl text-purple-200"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-orders" class="hidden space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">จัดการคำสั่งซื้อ</h2>
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-100 text-gray-600 uppercase text-xs font-bold">
                        <tr>
                            <th class="p-4">Order ID</th>
                            <th class="p-4">ลูกค้า</th>
                            <th class="p-4">วันที่</th>
                            <th class="p-4">ยอดรวม</th>
                            <th class="p-4">สถานะ</th>
                            <th class="p-4 text-center">จัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="order-table-body" class="text-sm text-gray-700"></tbody>
                </table>
            </div>
        </div>

        <div id="section-reviews" class="hidden space-y-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">ตอบกลับรีวิวลูกค้า</h2>
            <div id="review-dashboard-list" class="space-y-4"></div>
        </div>

    </main>

    <script>
        // โหลดข้อมูล
        const orders = JSON.parse(localStorage.getItem('order_history')) || [];
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const reviews = JSON.parse(localStorage.getItem('product_reviews')) || {};
        
        // ข้อมูลสินค้า (Mockup เพื่อดึงชื่อสินค้าจาก ID ในหน้า Review)
        // หมายเหตุ: ในระบบจริงควรดึงจาก Central Storage แต่ที่นี่ใช้ Mapping ง่ายๆ
        const productNames = {
             1: "สมาร์ททีวี 55 นิ้ว", 2: "โน้ตบุ๊ก Ultra Slim", 3: "แท็บเล็ต Pro 11",
             4: "กล้อง Mirrorless", 5: "ลำโพงบลูทูธ", 6: "หูฟังไร้สาย ANC",
             7: "เมาส์เกมมิ่ง", 8: "คีย์บอร์ด RGB", 9: "สมาร์ทวอทช์",
             10: "พาวเวอร์แบงค์", 11: "หุ่นยนต์ดูดฝุ่น", 12: "จอเกมมิ่ง 27",
             13: "SSD พกพา", 14: "ไมโครโฟน", 15: "เมาส์ปากกา", 16: "เราเตอร์ Wi-Fi"
        };

        function init() {
            renderStats();
            renderOrders();
            renderReviews();
        }

        function showSection(id) {
            document.querySelectorAll('main > div').forEach(el => el.classList.add('hidden'));
            document.getElementById('section-' + id).classList.remove('hidden');
            
            document.querySelectorAll('.menu-item').forEach(el => {
                el.classList.remove('bg-gray-800', 'text-white');
                el.classList.add('text-gray-300');
            });
            document.getElementById('btn-' + id).classList.add('bg-gray-800', 'text-white');
            document.getElementById('btn-' + id).classList.remove('text-gray-300');
        }

        function renderStats() {
            // คำนวณยอดขายรวม (เอาตัวอักษร ฿ และ , ออก)
            const totalSales = orders.reduce((sum, order) => {
                const amount = parseFloat(order.total.replace(/[฿,]/g, ''));
                return sum + (isNaN(amount) ? 0 : amount);
            }, 0);

            document.getElementById('stat-total-sales').innerText = '฿' + totalSales.toLocaleString();
            document.getElementById('stat-order-count').innerText = orders.length;
            document.getElementById('stat-user-count').innerText = users.length;
        }

        function renderOrders() {
            const tbody = document.getElementById('order-table-body');
            if(orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-gray-400">ไม่มีคำสั่งซื้อ</td></tr>';
                return;
            }

            tbody.innerHTML = orders.reverse().map((order, index) => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-4 font-mono text-blue-600 font-bold">#${order.id}</td>
                    <td class="p-4 font-bold">${order.user}</td>
                    <td class="p-4 text-gray-500">${order.orderDate}</td>
                    <td class="p-4 font-bold text-red-600">${order.total}</td>
                    <td class="p-4"><span class="bg-green-100 text-green-700 py-1 px-3 rounded-full text-xs font-bold">ชำระเงินแล้ว</span></td>
                    <td class="p-4 text-center">
                        <button class="text-gray-400 hover:text-blue-600"><i class="fas fa-eye"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function renderReviews() {
            const container = document.getElementById('review-dashboard-list');
            container.innerHTML = '';
            let hasReview = false;

            for (const [productId, productReviews] of Object.entries(reviews)) {
                productReviews.forEach((review, index) => {
                    hasReview = true;
                    const pName = productNames[productId] || `สินค้า ID ${productId}`;
                    const replyHtml = review.adminReply 
                        ? `<div class="bg-blue-50 p-3 rounded mt-2 border border-blue-100 text-xs">
                             <span class="font-bold text-blue-800"><i class="fas fa-user-shield mr-1"></i> Admin ตอบกลับ:</span> 
                             <span class="text-gray-700">${review.adminReply}</span>
                           </div>`
                        : `<div class="mt-2 flex gap-2">
                             <input type="text" id="reply-input-${productId}-${index}" placeholder="พิมพ์ข้อความตอบกลับ..." class="border rounded px-2 py-1 text-xs w-full outline-none focus:border-blue-500">
                             <button onclick="submitReply(${productId}, ${index})" class="bg-blue-600 text-white text-xs px-3 py-1 rounded hover:bg-blue-700">ส่ง</button>
                           </div>`;

                    container.innerHTML += `
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <span class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded mb-1 inline-block">${pName}</span>
                                    <h4 class="font-bold text-gray-800 text-sm">${review.user} <span class="text-gray-400 font-normal text-xs">| ${review.date}</span></h4>
                                </div>
                                <div class="text-yellow-400 text-xs">${generateStars(review.rating)}</div>
                            </div>
                            <p class="text-gray-600 text-sm italic">"${review.text}"</p>
                            ${replyHtml}
                        </div>
                    `;
                });
            }

            if(!hasReview) container.innerHTML = '<p class="text-center text-gray-400">ยังไม่มีรีวิวจากลูกค้า</p>';
        }

        function submitReply(productId, index) {
            const input = document.getElementById(`reply-input-${productId}-${index}`);
            const text = input.value.trim();
            if(!text) return alert('กรุณาพิมพ์ข้อความ');

            // อัปเดตข้อมูลใน LocalStorage
            reviews[productId][index].adminReply = text;
            localStorage.setItem('product_reviews', JSON.stringify(reviews));
            
            alert('ตอบกลับเรียบร้อย');
            renderReviews(); // รีโหลดหน้า
        }

        function generateStars(rating) {
            let html = '';
            for(let i=1; i<=5; i++) html += (i <= Math.floor(rating)) ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
            return html;
        }

        init();
    </script>
</body>
</html>